## 后续优化计划

### 1. 备份文件启用 gzip 压缩

- **现状**：
  - 备份结果为纯文本 `.sql` 文件（表结构 + 数据，多行 `INSERT`）。
  - 大库或大表时，单次备份体积较大，占用磁盘与传输带宽。
- **优化思路**：
  - 将备份输出改为 `.sql.gz` 压缩格式，示例：
    - 直接管道：`mysqldump ... | gzip > table.sql.gz`
    - 或备份结束后，对生成的 `.sql` 做统一 gzip 压缩。
  - 预计可将备份体积压缩到原来的约 10%–30%，显著降低存储与传输成本。
- **还原方案**：
  - 还原脚本支持同时识别 `.sql` 与 `.sql.gz`：
    - `.sql`：继续使用 `mysql < file.sql`
    - `.sql.gz`：使用 `gzip -cd file.sql.gz | mysql`
  - 按扩展名或命名约定自动选择解压方式，不影响现有使用方式。
- **影响评估**：
  - 备份阶段：CPU 使用略有增加，磁盘写入大幅减少；整体耗时在大多数场景下不变或略有提升。
  - 还原阶段：MySQL 执行 SQL 仍是主要瓶颈，解压开销相对较小；总体耗时预计变化不大。
  - 需要同步更新文档（README）与 Web 界面文案，说明备份文件后缀变化与还原脚本兼容策略。

### 2. 备份自定义函数与存储过程

- **现状**：
  - 当前 `mysqldump` 仅导出表结构、数据和视图，不包含存储过程、函数和事件。
  - 迁移到新环境时，需要额外手工同步 routines。
- **优化思路**：
  - 在备份脚本的 `DUMP_CMD` 中按需增加 `--routines`（以及可选 `--events`）参数：
    - 支持通过开关控制：例如 `INCLUDE_ROUTINES=1` 时才追加 `--routines`。
  - 评估并确保备份账号具备导出 routines 所需权限（如 `SHOW VIEW`、`SELECT`、`CREATE ROUTINE` 等）。
- **还原方案**：
  - 在还原脚本中，确保执行备份文件中的 `CREATE PROCEDURE` / `CREATE FUNCTION` / `CREATE EVENT` 语句：
    - 需要还原账号拥有相应的 `CREATE ROUTINE` / `ALTER ROUTINE` / `EVENT` 权限。
  - 文档中明确说明：在多环境（测试/生产）间迁移时，routine 会随数据结构一并迁移。
  - 可选：提供单独只导出/导入 routines 的模式，方便独立迁移或排错。

